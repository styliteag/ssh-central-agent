#!/usr/bin/env python3
import os
import sys
from pathlib import Path

# Set environment variables (same as template)
playbook_dir = Path(__file__).parent.resolve()
os.environ.setdefault("RUSERNAME", "wb")  # Update from localvars.yml if needed
os.environ.setdefault("SCA_SSH_AUTH_SOCK", str(Path.home() / ".ssh" / "scadev-agent.sock"))
os.environ.setdefault("MUX_SSH_AUTH_SOCK", str(Path.home() / ".ssh" / "scadev-mux.sock"))
os.environ.setdefault("PLAYBOOK_DIR", str(playbook_dir))
os.environ.setdefault("SSH_CONFIG_FILE", "config")
os.environ.setdefault("SCA_SCRIPT", __file__)

# Add playbook directory to Python path
sys.path.insert(0, str(playbook_dir))

# Import and run main function
try:
    from sca.__main__ import main
    main()
except ImportError as e:
    print(f"Error: Failed to import SCA module: {e}", file=sys.stderr)
    print("Make sure the sca package is in the Python path", file=sys.stderr)
    sys.exit(1)
except Exception as e:
    print(f"Error: {e}", file=sys.stderr)
    import traceback
    traceback.print_exc()
    sys.exit(1)
